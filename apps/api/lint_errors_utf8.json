[{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\app.controller.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\app.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\app.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\app.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\auth\\auth.controller.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\auth\\auth.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\auth\\auth.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\auth\\auth.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\auth\\auth.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'UnauthorizedException' is defined but never used.","line":3,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"UnauthorizedException"},"fix":{"range":[22,48],"text":""},"desc":"Remove unused variable \"UnauthorizedException\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'password' is assigned a value but never used.","line":29,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":23},{"ruleId":"@typescript-eslint/require-await","severity":2,"message":"Async method 'login' has no 'await' expression.","line":35,"column":3,"nodeType":"FunctionExpression","messageId":"missingAwait","endLine":35,"endColumn":14,"suggestions":[{"messageId":"removeAsync","fix":{"range":[971,977],"text":""},"desc":"Remove 'async'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'password' is assigned a value but never used.","line":75,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":21}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Injectable,\r\n  UnauthorizedException,\r\n  BadRequestException,\r\n} from '@nestjs/common';\r\nimport { JwtService } from '@nestjs/jwt';\r\nimport { PrismaService } from '../prisma/prisma.service';\r\nimport * as bcrypt from 'bcrypt';\r\nimport { User, Role } from '@prisma/client';\r\nimport { RegisterDto } from './dto/auth.dto';\r\n\r\n// Define a safe user type that excludes the password\r\nexport type SafeUser = Omit<User, 'password'> & { role?: Role | null };\r\n\r\n@Injectable()\r\nexport class AuthService {\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private jwtService: JwtService,\r\n  ) {}\r\n\r\n  async validateUser(email: string, pass: string): Promise<SafeUser | null> {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { email },\r\n      include: { role: true },\r\n    });\r\n\r\n    if (user && (await bcrypt.compare(pass, user.password))) {\r\n      const { password, ...result } = user;\r\n      return result;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async login(user: SafeUser) {\r\n    const payload = { email: user.email, sub: user.id, role: user.role?.name };\r\n    return {\r\n      access_token: this.jwtService.sign(payload),\r\n      user: {\r\n        id: user.id,\r\n        email: user.email,\r\n        name: user.name,\r\n      },\r\n    };\r\n  }\r\n\r\n  async register(data: RegisterDto) {\r\n    // Redundant manual check: Our PrismaClientExceptionFilter handles P2002 automatically,\r\n    // but checking here yields a faster friendlier message.\r\n    const existing = await this.prisma.user.findUnique({\r\n      where: { email: data.email },\r\n    });\r\n    if (existing) throw new BadRequestException('Email already in use');\r\n\r\n    const hashedPassword = await bcrypt.hash(data.password, 10);\r\n\r\n    // Ensure we have a default role CUSTOMER\r\n    let role = await this.prisma.role.findFirst({\r\n      where: { name: 'CUSTOMER' },\r\n    });\r\n    if (!role) {\r\n      role = await this.prisma.role.create({ data: { name: 'CUSTOMER' } });\r\n    }\r\n\r\n    const user = await this.prisma.user.create({\r\n      data: {\r\n        email: data.email,\r\n        password: hashedPassword,\r\n        name: data.name,\r\n        roleId: role.id,\r\n      },\r\n      include: { role: true },\r\n    });\r\n\r\n    const { password, ...safeUser } = user;\r\n    return this.login(safeUser);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\auth\\dto\\auth.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\auth\\jwt-auth.guard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\auth\\jwt.strategy.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":22,"column":16,"nodeType":"Property","messageId":"anyAssignment","endLine":22,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .sub on an `any` value.","line":22,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":22,"endColumn":31}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, UnauthorizedException } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { PassportStrategy } from '@nestjs/passport';\r\nimport { ExtractJwt, Strategy } from 'passport-jwt';\r\nimport { PrismaService } from '../prisma/prisma.service';\r\n\r\n@Injectable()\r\nexport class JwtStrategy extends PassportStrategy(Strategy) {\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private configService: ConfigService,\r\n  ) {\r\n    super({\r\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\r\n      ignoreExpiration: false,\r\n      secretOrKey: configService.getOrThrow<string>('JWT_SECRET'),\r\n    });\r\n  }\r\n\r\n  async validate(payload: any) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: payload.sub },\r\n      include: { role: true },\r\n    });\r\n\r\n    if (!user) {\r\n      throw new UnauthorizedException();\r\n    }\r\n\r\n    return user;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\cart\\cart.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\cart\\cart.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\cart\\cart.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\common\\filters\\prisma-client-exception.filter.ts","messages":[{"ruleId":"@typescript-eslint/no-base-to-string","severity":2,"message":"'target' will use Object's default stringification format ('[object Object]') when stringified.","line":30,"column":63,"nodeType":"Identifier","messageId":"baseToString","endLine":30,"endColumn":69},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"{}\" of template literal expression.","line":30,"column":63,"nodeType":"Identifier","messageId":"invalidType","endLine":30,"endColumn":69}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  ExceptionFilter,\r\n  Catch,\r\n  ArgumentsHost,\r\n  HttpStatus,\r\n  Logger,\r\n} from '@nestjs/common';\r\nimport { Prisma } from '@prisma/client';\r\nimport { Response, Request } from 'express';\r\n\r\n@Catch(Prisma.PrismaClientKnownRequestError)\r\nexport class PrismaClientExceptionFilter implements ExceptionFilter {\r\n  private readonly logger = new Logger(PrismaClientExceptionFilter.name);\r\n\r\n  catch(exception: Prisma.PrismaClientKnownRequestError, host: ArgumentsHost) {\r\n    const ctx = host.switchToHttp();\r\n    const response = ctx.getResponse<Response>();\r\n    const request = ctx.getRequest<Request>();\r\n\r\n    let status = HttpStatus.INTERNAL_SERVER_ERROR;\r\n    let message = 'Internal database error';\r\n\r\n    // Log the error details for server diagnostics\r\n    this.logger.error(`${request.method} ${request.url}`, exception.stack);\r\n\r\n    switch (exception.code) {\r\n      case 'P2002': {\r\n        status = HttpStatus.CONFLICT;\r\n        const target = exception.meta?.target || 'unknown target';\r\n        message = `Unique constraint failed on the fields: (${target})`;\r\n        break;\r\n      }\r\n      case 'P2025': {\r\n        status = HttpStatus.NOT_FOUND;\r\n        message = 'Record not found to update or delete';\r\n        break;\r\n      }\r\n      case 'P2003': {\r\n        status = HttpStatus.BAD_REQUEST;\r\n        message = 'Foreign key constraint failed';\r\n        break;\r\n      }\r\n      default:\r\n        // Use generic 500 status and message for unaccounted errors but log the specifics\r\n        this.logger.warn(`Unhandled Prisma Code: ${exception.code}`);\r\n        break;\r\n    }\r\n\r\n    response.status(status).json({\r\n      statusCode: status,\r\n      message,\r\n      timestamp: new Date().toISOString(),\r\n      path: request.url,\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\config\\cors.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\config\\env.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\config\\swagger.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\email\\email.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\email\\email.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\health.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\main.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":15,"column":3,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":15,"endColumn":5},{"ruleId":"@typescript-eslint/no-floating-promises","severity":1,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":43,"column":1,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":43,"endColumn":13,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[1386,1386],"text":"void "},"desc":"Add void operator to ignore."},{"messageId":"floatingFixAwait","fix":{"range":[1386,1386],"text":"await "},"desc":"Add await operator."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NestFactory } from '@nestjs/core';\r\nimport { AppModule } from './app.module';\r\nimport { Logger, ValidationPipe } from '@nestjs/common';\r\nimport helmet from 'helmet';\r\nimport cookieParser from 'cookie-parser';\r\n\r\n// Configs\r\nimport { getCorsConfig } from './config/cors.config';\r\nimport { setupSwagger } from './config/swagger.config';\r\nimport { PrismaClientExceptionFilter } from './common/filters/prisma-client-exception.filter';\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n  const logger = new Logger('Bootstrap');\r\n  1;\r\n  // 1. Security & Middleware\r\n  app.use(helmet());\r\n  app.enableCors(getCorsConfig());\r\n  app.use(cookieParser());\r\n\r\n  // 1.5 Validation & Error Handling\r\n  app.useGlobalPipes(\r\n    new ValidationPipe({\r\n      whitelist: true, // Strips out properties without decorators\r\n      transform: true, // Automatically transform payload to DTO instances\r\n      forbidNonWhitelisted: true, // Throw an error if extraneous properties are provided\r\n    }),\r\n  );\r\n  app.useGlobalFilters(new PrismaClientExceptionFilter());\r\n\r\n  // 2. Global Route Prefix\r\n  app.setGlobalPrefix('api', { exclude: ['health'] });\r\n\r\n  // 3. API Documentation\r\n  setupSwagger(app);\r\n\r\n  // 4. Start Server\r\n  const port = process.env.PORT || 3001;\r\n  await app.listen(port);\r\n\r\n  logger.log(`≡ƒÜÇ E-Commerce API running on port ${port}`);\r\n}\r\nbootstrap();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\orders\\dto\\order.dto.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ApiPropertyOptional' is defined but never used.","line":1,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ApiPropertyOptional"},"fix":{"range":[20,41],"text":""},"desc":"Remove unused variable \"ApiPropertyOptional\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'IsOptional' is defined but never used.","line":5,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"IsOptional"},"fix":{"range":[102,117],"text":""},"desc":"Remove unused variable \"IsOptional\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';\r\nimport {\r\n  IsString,\r\n  IsNumber,\r\n  IsOptional,\r\n  IsArray,\r\n  ValidateNested,\r\n  Min,\r\n  IsIn,\r\n} from 'class-validator';\r\nimport { Type } from 'class-transformer';\r\n\r\nexport class OrderItemDto {\r\n  @ApiProperty({ example: 'clx_product_id_123', description: 'Product ID' })\r\n  @IsString()\r\n  productId: string;\r\n\r\n  @ApiProperty({ example: 2, description: 'Quantity to order' })\r\n  @IsNumber()\r\n  @Min(1)\r\n  quantity: number;\r\n}\r\n\r\nexport class CreateOrderDto {\r\n  @ApiProperty({\r\n    type: [OrderItemDto],\r\n    description: 'Array of items in the order',\r\n  })\r\n  @IsArray()\r\n  @ValidateNested({ each: true })\r\n  @Type(() => OrderItemDto)\r\n  items: OrderItemDto[];\r\n\r\n  @ApiProperty({\r\n    example: 'clx_address_id_123',\r\n    description: 'Saved address ID for shipping',\r\n  })\r\n  @IsString()\r\n  addressId: string;\r\n}\r\n\r\nexport class UpdateOrderStatusDto {\r\n  @ApiProperty({\r\n    example: 'SHIPPED',\r\n    description: 'New order status',\r\n    enum: ['PENDING', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED'],\r\n  })\r\n  @IsString()\r\n  @IsIn(['PENDING', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED'])\r\n  status: string;\r\n}\r\n\r\nexport class OrderResponseDto {\r\n  @ApiProperty({ example: 'clx_order_id_123' })\r\n  id: string;\r\n\r\n  @ApiProperty({ example: 'clx_user_id_456' })\r\n  userId: string;\r\n\r\n  @ApiProperty({\r\n    example: 'PENDING',\r\n    enum: ['PENDING', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED'],\r\n  })\r\n  status: string;\r\n\r\n  @ApiProperty({ example: 199.98 })\r\n  total: number;\r\n\r\n  @ApiProperty({ type: [OrderItemDto] })\r\n  items: OrderItemDto[];\r\n\r\n  @ApiProperty({ example: '2024-01-01T00:00:00.000Z' })\r\n  createdAt: string;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\orders\\orders.controller.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":51,"column":7,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":51,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":51,"column":11,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":51,"endColumn":15},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":51,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":51,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":68,"column":45,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":68,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":68,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":68,"column":68,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":92,"column":43,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":92,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":92,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":92,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":92,"column":66,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":92,"endColumn":70}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Body,\r\n  Param,\r\n  Patch,\r\n  UseGuards,\r\n  Request,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiTags,\r\n  ApiOperation,\r\n  ApiBody,\r\n  ApiResponse,\r\n  ApiBearerAuth,\r\n  ApiParam,\r\n  ApiUnauthorizedResponse,\r\n  ApiNotFoundResponse,\r\n} from '@nestjs/swagger';\r\nimport { OrdersService } from './orders.service';\r\nimport { JwtAuthGuard } from '../auth/jwt-auth.guard';\r\nimport { OrderStatus } from '@prisma/client';\r\nimport {\r\n  CreateOrderDto,\r\n  UpdateOrderStatusDto,\r\n  OrderResponseDto,\r\n} from './dto/order.dto';\r\n\r\n@ApiTags('Orders')\r\n@ApiBearerAuth()\r\n@Controller('orders')\r\n@UseGuards(JwtAuthGuard)\r\nexport class OrdersController {\r\n  constructor(private readonly ordersService: OrdersService) {}\r\n\r\n  @Post()\r\n  @ApiOperation({\r\n    summary: 'Create an order',\r\n    description: 'Create a new order for the authenticated user.',\r\n  })\r\n  @ApiBody({ type: CreateOrderDto })\r\n  @ApiResponse({\r\n    status: 201,\r\n    description: 'Order created successfully',\r\n    type: OrderResponseDto,\r\n  })\r\n  @ApiUnauthorizedResponse({ description: 'JWT token is missing or invalid' })\r\n  create(@Request() req: any, @Body() createOrderDto: CreateOrderDto) {\r\n    return this.ordersService.create(\r\n      req.user.userId || req.user.id,\r\n      createOrderDto,\r\n    );\r\n  }\r\n\r\n  @Get()\r\n  @ApiOperation({\r\n    summary: 'Get my orders',\r\n    description: 'Retrieve all orders for the currently authenticated user.',\r\n  })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'List of orders',\r\n    type: [OrderResponseDto],\r\n  })\r\n  @ApiUnauthorizedResponse({ description: 'JWT token is missing or invalid' })\r\n  findAll(@Request() req: any) {\r\n    return this.ordersService.findAllByUser(req.user.userId || req.user.id);\r\n  }\r\n\r\n  @Get(':id')\r\n  @ApiOperation({\r\n    summary: 'Get an order by ID',\r\n    description:\r\n      'Retrieve a specific order. Users can only retrieve their own orders.',\r\n  })\r\n  @ApiParam({\r\n    name: 'id',\r\n    description: 'Order ID',\r\n    example: 'clx_order_id_123',\r\n  })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Order details',\r\n    type: OrderResponseDto,\r\n  })\r\n  @ApiUnauthorizedResponse({ description: 'JWT token is missing or invalid' })\r\n  @ApiNotFoundResponse({\r\n    description: 'Order not found or does not belong to the user',\r\n  })\r\n  findOne(@Request() req: any, @Param('id') id: string) {\r\n    return this.ordersService.findOne(id, req.user.userId || req.user.id);\r\n  }\r\n\r\n  @Patch(':id/status')\r\n  @ApiOperation({\r\n    summary: 'Update order status',\r\n    description:\r\n      'Update the status of an order. Typically restricted to Admin roles.',\r\n  })\r\n  @ApiParam({\r\n    name: 'id',\r\n    description: 'Order ID',\r\n    example: 'clx_order_id_123',\r\n  })\r\n  @ApiBody({ type: UpdateOrderStatusDto })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Order status updated successfully',\r\n    type: OrderResponseDto,\r\n  })\r\n  @ApiUnauthorizedResponse({ description: 'JWT token is missing or invalid' })\r\n  @ApiNotFoundResponse({ description: 'Order not found' })\r\n  updateStatus(@Param('id') id: string, @Body('status') status: OrderStatus) {\r\n    return this.ordersService.updateStatus(id, status);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\orders\\orders.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\orders\\orders.service.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":30,"column":35,"nodeType":"Property","messageId":"anyAssignment","endLine":30,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .order on an `any` value.","line":45,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":45,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .order on an `any` value.","line":51,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":51,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .order on an `any` value.","line":62,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":62,"endColumn":28}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Test, TestingModule } from '@nestjs/testing';\r\nimport { OrdersService } from './orders.service';\r\nimport { PrismaService } from '../prisma/prisma.service';\r\nimport { OrderStatus } from '@prisma/client';\r\n\r\ndescribe('OrdersService', () => {\r\n  let service: OrdersService;\r\n  let prismaMock: any;\r\n\r\n  beforeEach(async () => {\r\n    prismaMock = {\r\n      order: {\r\n        create: jest.fn().mockResolvedValue({\r\n          id: 'order-123',\r\n          status: OrderStatus.PENDING,\r\n          totalAmount: 100,\r\n        }),\r\n        findMany: jest.fn().mockResolvedValue([{ id: 'order-123' }]),\r\n        findFirst: jest.fn().mockResolvedValue({ id: 'order-123' }),\r\n        update: jest.fn().mockResolvedValue({\r\n          id: 'order-123',\r\n          status: OrderStatus.PROCESSING,\r\n        }),\r\n      },\r\n    };\r\n\r\n    const module: TestingModule = await Test.createTestingModule({\r\n      providers: [\r\n        OrdersService,\r\n        { provide: PrismaService, useValue: prismaMock },\r\n      ],\r\n    }).compile();\r\n\r\n    service = module.get<OrdersService>(OrdersService);\r\n  });\r\n\r\n  it('should be defined', () => {\r\n    expect(service).toBeDefined();\r\n  });\r\n\r\n  it('should create an order successfully', async () => {\r\n    const orderDto = { totalAmount: 100, items: [] };\r\n    const order = await service.create('user-1', orderDto);\r\n    expect(order.id).toEqual('order-123');\r\n    expect(prismaMock.order.create).toHaveBeenCalled();\r\n  });\r\n\r\n  it('should fetch orders by user id', async () => {\r\n    const orders = await service.findAllByUser('user-1');\r\n    expect(orders.length).toBeGreaterThan(0);\r\n    expect(prismaMock.order.findMany).toHaveBeenCalledWith(\r\n      expect.objectContaining({ where: { userId: 'user-1' } }),\r\n    );\r\n  });\r\n\r\n  it('should update order status', async () => {\r\n    const updated = await service.updateStatus(\r\n      'order-123',\r\n      OrderStatus.PROCESSING,\r\n    );\r\n    expect(updated.status).toEqual(OrderStatus.PROCESSING);\r\n    expect(prismaMock.order.update).toHaveBeenCalled();\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\orders\\orders.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\payments\\dto\\payment.dto.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ApiPropertyOptional' is defined but never used.","line":1,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ApiPropertyOptional"},"fix":{"range":[20,41],"text":""},"desc":"Remove unused variable \"ApiPropertyOptional\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';\r\nimport {\r\n  IsString,\r\n  IsNumber,\r\n  IsArray,\r\n  ValidateNested,\r\n  Min,\r\n  IsUrl,\r\n} from 'class-validator';\r\nimport { Type } from 'class-transformer';\r\n\r\nexport class CheckoutItemDto {\r\n  @ApiProperty({ example: 'clx_product_id_123', description: 'Product ID' })\r\n  @IsString()\r\n  productId: string;\r\n\r\n  @ApiProperty({ example: 'Wireless Headphones', description: 'Product name' })\r\n  @IsString()\r\n  name: string;\r\n\r\n  @ApiProperty({ example: 99.99, description: 'Product price' })\r\n  @IsNumber()\r\n  @Min(0)\r\n  price: number;\r\n\r\n  @ApiProperty({ example: 2, description: 'Quantity' })\r\n  @IsNumber()\r\n  @Min(1)\r\n  quantity: number;\r\n}\r\n\r\nexport class CreateCheckoutSessionDto {\r\n  @ApiProperty({\r\n    example: 'clx_order_id_123',\r\n    description: 'The order ID to create a checkout session for',\r\n  })\r\n  @IsString()\r\n  orderId: string;\r\n\r\n  @ApiProperty({\r\n    type: [CheckoutItemDto],\r\n    description: 'Items to include in the checkout session',\r\n  })\r\n  @IsArray()\r\n  @ValidateNested({ each: true })\r\n  @Type(() => CheckoutItemDto)\r\n  items: CheckoutItemDto[];\r\n\r\n  @ApiProperty({\r\n    example: 'https://yourstore.com/success',\r\n    description: 'URL to redirect to after successful payment',\r\n  })\r\n  @IsUrl()\r\n  successUrl: string;\r\n\r\n  @ApiProperty({\r\n    example: 'https://yourstore.com/cancel',\r\n    description: 'URL to redirect to if payment is cancelled',\r\n  })\r\n  @IsUrl()\r\n  cancelUrl: string;\r\n}\r\n\r\nexport class CheckoutSessionResponseDto {\r\n  @ApiProperty({\r\n    example: 'https://checkout.stripe.com/pay/cs_test_...',\r\n    description: 'Stripe checkout session URL',\r\n  })\r\n  url: string;\r\n\r\n  @ApiProperty({ example: 'cs_test_a1B2c3D4e5F6g7H8...' })\r\n  sessionId: string;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\payments\\payments.controller.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":79,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":79,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .rawBody on an `any` value.","line":79,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":79,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .body on an `any` value.","line":79,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":79,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":82,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":82,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":86,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":86,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":87,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":87,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .metadata on an `any` value.","line":87,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":87,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":88,"column":48,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":88,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":88,"column":57,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":88,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":88,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":88,"endColumn":67}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Controller,\r\n  Post,\r\n  Body,\r\n  Req,\r\n  Headers,\r\n  BadRequestException,\r\n  UseGuards,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiTags,\r\n  ApiOperation,\r\n  ApiBody,\r\n  ApiResponse,\r\n  ApiBearerAuth,\r\n  ApiHeader,\r\n  ApiUnauthorizedResponse,\r\n  ApiBadRequestResponse,\r\n} from '@nestjs/swagger';\r\nimport { PaymentsService } from './payments.service';\r\nimport { JwtAuthGuard } from '../auth/jwt-auth.guard';\r\nimport {\r\n  CreateCheckoutSessionDto,\r\n  CheckoutSessionResponseDto,\r\n} from './dto/payment.dto';\r\n\r\n@ApiTags('Payments')\r\n@Controller('payments')\r\nexport class PaymentsController {\r\n  constructor(private readonly paymentsService: PaymentsService) {}\r\n\r\n  @UseGuards(JwtAuthGuard)\r\n  @Post('checkout')\r\n  @ApiBearerAuth()\r\n  @ApiOperation({\r\n    summary: 'Create a Stripe checkout session',\r\n    description:\r\n      'Initiates a Stripe checkout session for the given order. Returns a redirect URL to the Stripe-hosted payment page.',\r\n  })\r\n  @ApiBody({ type: CreateCheckoutSessionDto })\r\n  @ApiResponse({\r\n    status: 201,\r\n    description: 'Checkout session created',\r\n    type: CheckoutSessionResponseDto,\r\n  })\r\n  @ApiUnauthorizedResponse({ description: 'JWT token is missing or invalid' })\r\n  async createCheckoutSession(@Body() body: CreateCheckoutSessionDto) {\r\n    return this.paymentsService.createCheckoutSession(\r\n      body.orderId,\r\n      body.items,\r\n      body.successUrl,\r\n      body.cancelUrl,\r\n    );\r\n  }\r\n\r\n  @Post('webhook')\r\n  @ApiOperation({\r\n    summary: 'Stripe webhook handler',\r\n    description:\r\n      'Endpoint for Stripe to send payment event webhooks. Do NOT call this manually ΓÇö it requires a valid Stripe signature header.',\r\n  })\r\n  @ApiHeader({\r\n    name: 'stripe-signature',\r\n    description: 'Stripe webhook signature (automatically sent by Stripe)',\r\n    required: true,\r\n  })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Webhook received',\r\n    schema: { example: { received: true } },\r\n  })\r\n  @ApiBadRequestResponse({ description: 'Invalid Stripe webhook signature' })\r\n  async handleStripeWebhook(\r\n    @Req() req: any,\r\n    @Headers('stripe-signature') signature: string,\r\n  ) {\r\n    let event;\r\n    try {\r\n      const rawBody = req.rawBody || req.body;\r\n      event = await this.paymentsService.constructEvent(rawBody, signature);\r\n    } catch (err: any) {\r\n      throw new BadRequestException(`Webhook Error: ${err.message}`);\r\n    }\r\n\r\n    if (event.type === 'checkout.session.completed') {\r\n      const session = event.data.object as any;\r\n      const orderId = session.metadata.orderId;\r\n      await this.paymentsService.verifyPayment(orderId, session.id);\r\n    }\r\n\r\n    return { received: true };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\payments\\payments.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\payments\\payments.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `StripeConfig | undefined`.","line":19,"column":7,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":19,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":33,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":33,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .product on an `any` value.","line":33,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":33,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .title on an `any` value.","line":33,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":33,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":35,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":35,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":37,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":37,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":37,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":37,"endColumn":30},{"ruleId":"@typescript-eslint/require-await","severity":2,"message":"Async method 'constructEvent' has no 'await' expression.","line":54,"column":3,"nodeType":"FunctionExpression","messageId":"missingAwait","endLine":54,"endColumn":23,"suggestions":[{"messageId":"removeAsync","fix":{"range":[1526,1532],"text":""},"desc":"Remove 'async'."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string | Buffer<ArrayBufferLike>`.","line":59,"column":9,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":59,"endColumn":16},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":64,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":64,"endColumn":66}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, BadRequestException } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { PrismaService } from '../prisma/prisma.service';\r\nimport { PaymentMethod, PaymentStatus } from '@prisma/client';\r\nimport Stripe from 'stripe';\r\n\r\n@Injectable()\r\nexport class PaymentsService {\r\n  private stripe: Stripe;\r\n\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private configService: ConfigService,\r\n  ) {\r\n    // Cast options to any to satisfy specific stripe version type constraints temporarily\r\n    const options: any = { apiVersion: '2023-10-16' };\r\n    this.stripe = new Stripe(\r\n      this.configService.get<string>('STRIPE_SECRET_KEY') || 'sk_test_mock',\r\n      options,\r\n    );\r\n  }\r\n\r\n  async createCheckoutSession(\r\n    orderId: string,\r\n    items: any[],\r\n    successUrl: string,\r\n    cancelUrl: string,\r\n  ) {\r\n    const lineItems = items.map((item) => ({\r\n      price_data: {\r\n        currency: 'usd',\r\n        product_data: {\r\n          name: item.product?.title || item.title || 'Product Item',\r\n        },\r\n        unit_amount: Math.round(item.price * 100),\r\n      },\r\n      quantity: item.quantity,\r\n    }));\r\n\r\n    const session = await this.stripe.checkout.sessions.create({\r\n      payment_method_types: ['card'],\r\n      line_items: lineItems,\r\n      mode: 'payment',\r\n      success_url: successUrl,\r\n      cancel_url: cancelUrl,\r\n      metadata: {\r\n        orderId: orderId,\r\n      },\r\n    });\r\n\r\n    return { url: session.url, sessionId: session.id };\r\n  }\r\n\r\n  async constructEvent(payload: any, signature: string) {\r\n    const endpointSecret =\r\n      this.configService.get<string>('STRIPE_WEBHOOK_SECRET') || 'whsec_test';\r\n    try {\r\n      return this.stripe.webhooks.constructEvent(\r\n        payload,\r\n        signature,\r\n        endpointSecret,\r\n      );\r\n    } catch (err: any) {\r\n      throw new BadRequestException(`Webhook Error: ${err.message}`);\r\n    }\r\n  }\r\n\r\n  async verifyPayment(\r\n    orderId: string,\r\n    transactionId: string,\r\n    method: PaymentMethod = PaymentMethod.STRIPE,\r\n  ) {\r\n    const order = await this.prisma.order.findUnique({\r\n      where: { id: orderId },\r\n    });\r\n    if (!order) throw new BadRequestException('Order not found');\r\n\r\n    const payment = await this.prisma.payment.create({\r\n      data: {\r\n        orderId,\r\n        amount: order.totalAmount,\r\n        method,\r\n        status: PaymentStatus.COMPLETED,\r\n        transactionId,\r\n      },\r\n    });\r\n\r\n    await this.prisma.order.update({\r\n      where: { id: orderId },\r\n      data: { status: 'PROCESSING' },\r\n    });\r\n\r\n    return payment;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\prisma\\prisma.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\prisma\\prisma.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\prisma\\prisma.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\products\\dto\\product.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\products\\products.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\products\\products.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\products\\products.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BadRequestException' is defined but never used.","line":4,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BadRequestException"},"fix":{"range":[44,68],"text":""},"desc":"Remove unused variable \"BadRequestException\"."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .category on an `any` value.","line":48,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":48,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .category on an `any` value.","line":58,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":58,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":63,"column":41,"nodeType":"Property","messageId":"anyAssignment","endLine":63,"endColumn":58}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Injectable,\r\n  NotFoundException,\r\n  BadRequestException,\r\n} from '@nestjs/common';\r\nimport { PrismaService } from '../prisma/prisma.service';\r\nimport { SettingsService } from '../settings/settings.service';\r\nimport {\r\n  CreateProductDto,\r\n  UpdateProductDto,\r\n  ProductQueryDto,\r\n} from './dto/product.dto';\r\nimport { Prisma } from '@prisma/client';\r\n\r\n@Injectable()\r\nexport class ProductsService {\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private settings: SettingsService,\r\n  ) {}\r\n\r\n  private generateSlug(title: string): string {\r\n    return (\r\n      title\r\n        .toLowerCase()\r\n        .replace(/[^a-z0-9]+/g, '-')\r\n        .replace(/(^-|-$)+/g, '') +\r\n      '-' +\r\n      Math.random().toString(36).substring(2, 8)\r\n    );\r\n  }\r\n\r\n  async create(data: CreateProductDto) {\r\n    // Map DTO 'name' to Prisma 'title', and auto-generate the required unique slug\r\n    const productData: any = {\r\n      title: data.name,\r\n      slug: this.generateSlug(data.name),\r\n      description: data.description,\r\n      price: data.price,\r\n      stock: data.stock ?? 0,\r\n      gallery: data.imageUrl ? [data.imageUrl] : [],\r\n    };\r\n\r\n    // If category is provided, connect it. Otherwise, create product without category if schema permits,\r\n    // or we have to assign a default. (Assuming default category or nullable in reality, though schema has it required. Let's make an 'Uncategorized' fallback if needed, but let's connect if provided).\r\n    // Wait, schema requires categoryId. We must ensure it's handled.\r\n    if (data.categoryId) {\r\n      productData.category = {\r\n        connect: { id: data.categoryId },\r\n      };\r\n    } else {\r\n      // For safety if categoryId is required but not passed, find or create \"Uncategorized\"\r\n      const defaultCategory = await this.prisma.category.upsert({\r\n        where: { slug: 'uncategorized' },\r\n        update: {},\r\n        create: { name: 'Uncategorized', slug: 'uncategorized' },\r\n      });\r\n      productData.category = {\r\n        connect: { id: defaultCategory.id },\r\n      };\r\n    }\r\n\r\n    return this.prisma.product.create({ data: productData });\r\n  }\r\n\r\n  async findAll(query: ProductQueryDto = {}) {\r\n    const isSingle = await this.settings.isSingleProductMode();\r\n    const singleId = await this.settings.getSingleProductId();\r\n\r\n    if (isSingle && singleId) {\r\n      return this.prisma.product.findMany({\r\n        where: { id: singleId },\r\n        include: { variants: true, category: true },\r\n      });\r\n    }\r\n\r\n    // Default multi-product fetching with secure pagination and search parsing\r\n    const search = query.search;\r\n    const categoryId = query.categoryId;\r\n    const page = Math.max(1, query.page || 1);\r\n    const limit = Math.max(1, query.limit || 10);\r\n    const skip = (page - 1) * limit;\r\n\r\n    const where: Prisma.ProductWhereInput = {};\r\n\r\n    if (search) {\r\n      where.OR = [\r\n        { title: { contains: search, mode: 'insensitive' } },\r\n        { description: { contains: search, mode: 'insensitive' } },\r\n      ];\r\n    }\r\n\r\n    if (categoryId) {\r\n      where.categoryId = categoryId;\r\n    }\r\n\r\n    const [products, total] = await Promise.all([\r\n      this.prisma.product.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: { variants: true, category: true },\r\n        orderBy: { createdAt: 'desc' }, // Default sorting\r\n      }),\r\n      this.prisma.product.count({ where }),\r\n    ]);\r\n\r\n    return { products, total, page, limit };\r\n  }\r\n\r\n  async findOne(id: string) {\r\n    const product = await this.prisma.product.findUnique({\r\n      where: { id },\r\n      include: { variants: true, category: true, reviews: true },\r\n    });\r\n    if (!product) throw new NotFoundException('Product not found');\r\n\r\n    // Safety check if in single mode\r\n    const isSingle = await this.settings.isSingleProductMode();\r\n    const singleId = await this.settings.getSingleProductId();\r\n    if (isSingle && singleId && singleId !== id) {\r\n      throw new NotFoundException(\r\n        'Store is currently restricted to a single product',\r\n      );\r\n    }\r\n\r\n    return product;\r\n  }\r\n\r\n  async update(id: string, data: UpdateProductDto) {\r\n    const updateData: Prisma.ProductUpdateInput = {};\r\n\r\n    if (data.name) {\r\n      updateData.title = data.name;\r\n    }\r\n    if (data.description) updateData.description = data.description;\r\n    if (data.price !== undefined) updateData.price = data.price;\r\n    if (data.stock !== undefined) updateData.stock = data.stock;\r\n\r\n    // Push the new image to gallery array if provided\r\n    if (data.imageUrl) {\r\n      updateData.gallery = {\r\n        push: data.imageUrl,\r\n      };\r\n    }\r\n\r\n    if (data.categoryId) {\r\n      updateData.category = {\r\n        connect: { id: data.categoryId },\r\n      };\r\n    }\r\n\r\n    return this.prisma.product.update({\r\n      where: { id },\r\n      data: updateData,\r\n    });\r\n  }\r\n\r\n  async remove(id: string) {\r\n    return this.prisma.product.delete({ where: { id } });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\settings\\settings.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\settings\\settings.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\settings\\settings.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'NotFoundException' is defined but never used.","line":1,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"NotFoundException"},"fix":{"range":[19,38],"text":""},"desc":"Remove unused variable \"NotFoundException\"."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":22,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":22,"endColumn":11}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, NotFoundException } from '@nestjs/common';\r\nimport { PrismaService } from '../prisma/prisma.service';\r\n\r\n@Injectable()\r\nexport class SettingsService {\r\n  constructor(private prisma: PrismaService) {}\r\n\r\n  async getSettings() {\r\n    let settings = await this.prisma.settings.findFirst();\r\n    if (!settings) {\r\n      settings = await this.prisma.settings.create({\r\n        data: { storeMode: 'multi' },\r\n      });\r\n    }\r\n    return settings;\r\n  }\r\n\r\n  async updateSettings(data: any) {\r\n    const settings = await this.getSettings();\r\n    return this.prisma.settings.update({\r\n      where: { id: settings.id },\r\n      data,\r\n    });\r\n  }\r\n\r\n  async isSingleProductMode() {\r\n    const settings = await this.getSettings();\r\n    return settings.storeMode === 'single';\r\n  }\r\n\r\n  async getSingleProductId() {\r\n    const settings = await this.getSettings();\r\n    if (settings.storeMode === 'single' && settings.singleProductId) {\r\n      return settings.singleProductId;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\storage\\storage.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\storage\\storage.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\storage\\storage.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\users\\users.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\users\\users.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\src\\users\\users.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\lifes\\Documents\\Projects\\E-Commerce\\apps\\api\\test\\app.e2e-spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
